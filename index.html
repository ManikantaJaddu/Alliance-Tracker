<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Alliance Tracker</title>

    <style>
      /* üåà Animated Gradient Background */
      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, sans-serif;
        color: #222;
        min-height: 100vh;
        padding: 20px;
        box-sizing: border-box;

        background: linear-gradient(135deg, #b4cff3, #f7d79d, #b4cff3);
        background-size: 400% 400%;
        animation: bgFlow 18s ease infinite;

        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
      }

      @keyframes bgFlow {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* üéØ Header */
      .brand-title {
        font-size: 2.2rem;
        font-weight: 700;
        letter-spacing: 1px;
        margin-bottom: 30px;
        text-align: center;
      }

      .brand-title .alliance {
        color: #0b5ed7; /* Alliance Blue */
      }

      .brand-title .pro {
        color: #f5a623; /* Pro Orange */
      }

      @keyframes fadeInDown {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      /* üì¶ Iframe Container */
      .iframe-container {
        display: flex;
        justify-content: center;
        width: 100%;
        animation: fadeIn 1.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* üßæ Zoho Form */
      iframe {
        border: none;
        border-radius: 15px;
        box-shadow: 0px 6px 20px rgba(0, 0, 0, 0.3);
        background: white;
        width: 95%;
        max-width: 1000px;
        height: 550px;
        transition:
          transform 0.4s ease,
          box-shadow 0.4s ease;
      }

      iframe:hover {
        transform: scale(1.02);
        box-shadow: 0px 12px 30px rgba(0, 0, 0, 0.35);
      }

      /* üì± Responsive */
      @media (max-width: 768px) {
        h2 {
          font-size: 1.5rem;
          padding: 10px 20px;
        }

        iframe {
          height: 600px;
        }
      }
    </style>

    <script>
      async function fillLocationAndTime() {
        if (!navigator.geolocation) {
          alert("Geolocation is not supported by this browser.");
          return;
        }

        navigator.geolocation.getCurrentPosition(
          async function (position) {
            const lat = Number(position.coords.latitude.toFixed(6));
            const lon = Number(position.coords.longitude.toFixed(6));

            // üïí Date & Time
            const now = new Date();
            const day = String(now.getDate()).padStart(2, "0");
            const monthNames = [
              "Jan",
              "Feb",
              "Mar",
              "Apr",
              "May",
              "Jun",
              "Jul",
              "Aug",
              "Sep",
              "Oct",
              "Nov",
              "Dec",
            ];
            const month = monthNames[now.getMonth()];
            const year = now.getFullYear();
            const dateStr = `${day}-${month}-${year}`;
            const timeStr = now.toLocaleTimeString("en-GB");

            // üìç Reverse Geocoding
            let mapAddress = "Unknown Location";
            try {
              const response = await fetch(
                `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`,
              );
              const data = await response.json();
              if (data && data.display_name) {
                mapAddress = data.display_name;
              }
            } catch (err) {
              console.error("Address fetch failed", err);
            }

            // üîó Zoho Field Names
            const formUrl =
              "https://creatorapp.zohopublic.com/allianceproitpvtltd/emp-tracker/form-embed/Alliance_FMS/HqXfJp29XhBUtgWgse7zTBOAFgXO2AUAAYYBmnevJhaNx7uaqXQnKz5mF4uyFNsH52hgsEHhUUJpVtXtFzNYPbY9N5ez2EXgjGq8" +
              `?GPS_Lat=${lat}` +
              `&GPS_Long=${lon}` +
              `&GPS_Date=${encodeURIComponent(dateStr)}` +
              `&GPS_Time=${encodeURIComponent(timeStr)}` +
              `&Map_Address=${encodeURIComponent(mapAddress)}`;

            document.getElementById("zohoForm").src = formUrl;
          },
          function (error) {
            alert("‚ùå Error getting location: " + error.message);
          },
        );
      }

      window.onload = fillLocationAndTime;
    </script>
  </head>

  <body>
    <h2 class="brand-title">
      <span class="alliance">ALLIANCE</span>
      <span class="pro">FMS</span>
    </h2>
    <div class="iframe-container">
      <iframe id="zohoForm" allow="geolocation"></iframe>
    </div>
  </body>
</html>
