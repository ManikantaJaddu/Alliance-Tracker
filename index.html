<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Alliance Tracker</title>
  <script>
    function fillLocationAndTime() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            // Use 6 decimals for Zoho's digit limit
            const lat = Number(position.coords.latitude.toFixed(6));
            const lon = Number(position.coords.longitude.toFixed(6));

            // Get current local date & time
            const now = new Date();

            // Format date as dd-mmm-yyyy
            const day = String(now.getDate()).padStart(2, "0");
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const month = monthNames[now.getMonth()];
            const year = now.getFullYear();
            const dateStr = `${day}-${month}-${year}`;

            // Format time as HH:MM:SS
            const timeStr = now.toLocaleTimeString("en-GB");

            // Field names in Zoho Creator (must match link names)
            const latField = "GPS_Lat";
            const lonField = "GPS_Long";
            const dateField = "GPS_Date";
            const timeField = "GPS_Time";

            // Build Zoho Creator form URL
            const formUrl =
              "https://creatorapp.zohopublic.com/allianceproitpvtltd/emp-tracker/form-embed/GPS_Tracker/F1qTgmwUVO8PyCm5MO0QjpE1Qy6rg6MBAAym2fw1aXnZD8AzvzD1O5mVJUwN5wFMAet29ewsOX3j9CwgdvjXRDaH56fN8rk0ejt7" +
              `?${latField}=${lat}&${lonField}=${lon}&${dateField}=${dateStr}&${timeField}=${timeStr}`;

            // Load form with pre-filled values
            document.getElementById("zohoForm").src = formUrl;
          },
          function (error) {
            alert("‚ùå Error getting location: " + error.message);
          }
        );
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    window.onload = fillLocationAndTime;
  </script>
</head>
<body>
  <iframe
    id="zohoForm"
    width="100%"
    height="800"
    frameborder="0"
    allow="geolocation"
  ></iframe>
</body>
</html>
